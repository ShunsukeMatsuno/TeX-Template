%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%% Documents %%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%
%% Document configuration
%%%%%%%%%%%%%%%%%%%%%

%%%% Fonts %%%%
\RequirePackage{fontspec} 


%%%% Line spacing %%%%
%\AtBeginDocument{\OnehalfSpacing}   % For single spacing, comment out this
\AtBeginDocument{\frenchspacing}


%%%% Section numbering depth %%%%
\setcounter{secnumdepth}{2}

%%%% Margin %%%%
\setulmarginsandblock{4cm}{4cm}{*}
\setlrmarginsandblock{3cm}{3cm}{*}
\checkandfixthelayout

%%%% Chapter headings %%%%
\setlength{\beforechapskip}{-20pt}
\setlength{\midchapskip}{10pt}
\setlength{\afterchapskip}{30pt}

%%%% Title %%%%
\RequirePackage{titling}
% \aliaspagestyle{title}{empty}

% Footnote for acknowledgement 
\newcommand\blfootnote[1]{%
  \begingroup
  \renewcommand\thefootnote{}\footnote{#1}%
  \addtocounter{footnote}{-1}%
  \endgroup
}

%%%% Paragraph %%%%
\parskip=5pt plus 1pt
\parindent=30pt

%%%% Color %%%%
\RequirePackage{xcolor}

% Original colors
\definecolor{lblue}{RGB}{0, 114, 206}
\definecolor{gray}{RGB}{111, 112, 112}
\definecolor{darkgray}{RGB}{125, 125, 125}
\definecolor{lgreen}{RGB}{47, 139, 89}

%%%% Hyper ref %%%%
\usepackage[pdfencoding=auto,psdextra,pdfusetitle]{hyperref} 
\hypersetup{
    colorlinks=true,
    linkcolor=lgreen,
    citecolor=lgreen,
    filecolor=lgreen,      
    urlcolor=lgreen
}
\pdfstringdefDisableCommands{%   % https://tex.stackexchange.com/questions/466229/hyperref-option-pdfusetitle-with-thanks
  \let\thanks\@gobble
}
%%%% Enumerate (adjust space) %%%%
\RequirePackage{enumitem}
\setlist{nosep}    % To remove the vertical space altogether in all lists

%%%% Footnote with line break in the editor %%%%
% https://tex.stackexchange.com/questions/94563/new-line-for-footnote-without-blank-space
\RequirePackage{xpatch}
\xpretocmd{\footnote}{\unskip}{}{}

%%%% Appendix %%%%
\RequirePackage{apptools}
\AtAppendix{\counterwithin{lemma}{section}}
\AtAppendix{\counterwithin{remark}{section}}
\AtAppendix{\counterwithin{theorem}{section}}

%%%%%%%%%%%%%%%%%%%%%
%% Bibliography
%%%%%%%%%%%%%%%%%%%%%
\input{biblatex-aer}     % This is in the original template set
% \RequirePackage{natbib}\setlength{\bibsep}{0.0pt}
% \usepackage[natbib=true]{biblatex}

%%%%%%%%%%%%%%%%%%%%%
%% Multifiles
%%%%%%%%%%%%%%%%%%%%%
\RequirePackage[subpreambles=true]{standalone}
\RequirePackage{import}

%%%%%%%%%%%%%%%%%%%%%
%% tikz
%%%%%%%%%%%%%%%%%%%%% 
\RequirePackage{tikz}

%%%%%%%%%%%%%%%%%%%%%
%% Float
%%%%%%%%%%%%%%%%%%%%% 
\RequirePackage{caption}   % See https://tex.stackexchange.com/questions/58674/the-space-between-the-table-and-its-caption-is-very-small
\RequirePackage{booktabs}
\RequirePackage{tabulary}
\RequirePackage{tabularx}
\RequirePackage{wrapfig}
\RequirePackage{threeparttable}
\RequirePackage{graphicx}


%%%%%%%%%%%%%%%%%%%%%
%% Editting Features
%%%%%%%%%%%%%%%%%%%%% 

%%%% TODO %%%%
\newcommand{\TODO}[1]{%
\ifthenelse { \equal{#1}{}}  %if #1 is empty
    { \textbf{\textcolor{red}{[TODO]}} }   % if #1 == blank
    { \textbf{\textcolor{red}{[TODO: #1]}} }   % else (not blank)
}
\RequirePackage{marginnote}    % note in margin

%%%%%%%%%%%%%%%%%%%%%
%% Quote
%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{epigraph}
\RequirePackage{etoolbox}
\RequirePackage{calc}
\renewcommand{\epigraphsize}{\normalsize}

% % normal epigraph
% \setlength\epigraphwidth{8cm}
% \setlength\epigraphrule{0pt}
% \patchcmd{\epigraph}{\@epitext{#1}}{\itshape\@epitext{#1}}{}{}

% short epigraph (auto width), does not work with long epigraph
\newcommand{\mytextformat}{\itshape\epigraphsize}
\setlength\epigraphrule{0pt}
\newenvironment{mytext}{\mytextformat}{}
\newenvironment{mysource}{\scshape\hfill}{}
\renewcommand{\textflush}{mytext} 
\renewcommand{\sourceflush}{mysource}
\let\originalepigraph\epigraph 
\renewcommand{\epigraph}[2]%
   {\setlength{\epigraphwidth}{\widthof{\mytextformat#1}}\originalepigraph{#1}{#2}}


%%%%%%%%%%%%%%%%%%%%%
%% Misc
%%%%%%%%%%%%%%%%%%%%% 
\RequirePackage{lipsum}
\RequirePackage{ifthen}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%% Math %%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%
%% Basics
%%%%%%%%%%%%%%%%%%%%% 
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{amsfonts}
\RequirePackage{mathtools}
\mathtoolsset{showonlyrefs=true}    % show equation number only if it is referenced
\RequirePackage{amsthm} 
\RequirePackage{amsfonts}
\RequirePackage{bm}   % vector
\RequirePackage{bbm}   % indicator function

%%%%%%%%%%%%%%%%%%%%%
%% Math Macro
%%%%%%%%%%%%%%%%%%%%% 

%%%% Standard Macro %%%%
% mathbb
\newcommand{\E}{\mathbb{E}}
\newcommand{\N}{\mathbb{N}}

% mathcal
\newcommand{\EE}{\mathcal{E}}
\newcommand{\NN}{\mathcal{N}}

% others
\newcommand{\prob}{\mathbb{P}}
\newcommand{\argmin}{\mathop{\rm arg~min}\limits}
\newcommand{\argmax}{\mathop{\rm arg~max}\limits}
\newcommand\setItemnumber[1]{\setcounter{enumi}{\numexpr#1-1\relax}}

% theorem macro
\newtheorem{theorem}{Theorem}
\newtheorem{assumption}{Assumption}
\newtheorem{algorithm}{Algorithm}
\newtheorem{axiom}{Axiom}
\newtheorem{case}{Case}
\newtheorem{claim}{Claim}
\newtheorem{conclusion}{Conclusion}
\newtheorem{condition}{Condition}
\newtheorem{conjecture}{Conjecture}
\newtheorem{corollary}{Corollary}
\newtheorem{criterion}[theorem]{Criterion}
\newtheorem{example}{Example}
\newtheorem{exercise}{Exercise}
\newtheorem{lemma}{Lemma}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{problem}[theorem]{Problem}
\newtheorem{proposition}{Proposition}


\theoremstyle{definition}
\newtheorem{remark}{Remark}
\newtheorem{definition}{Definition}
