%%% Beamer slide template

% theme
\usetheme[progressbar=frametitle, numbering=fraction]{metropolis} % Use metropolis theme

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%  Styles  %%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% Fonts %%%%%
\usefonttheme{professionalfonts}   % tells Beamer to stop those internal replacements and simply use your fonts as-is
\RequirePackage{mathtools}   % load before unicode-math
\RequirePackage{unicode-math}
\RequirePackage{fontspec}
% \setsansfont[BoldFont={Fira Sans SemiBold}]{Fira Sans Book}
\setsansfont{Libertinus Sans}[Scale=1.1]
\setmathfont{Libertinus Math}
\setmathfont{NewCMMath-Regular.otf}[range=cal]
\RequirePackage{esint}

\RequirePackage{emoji}

%%%% Colors %%%%%
\RequirePackage{xcolor}
\usecolortheme{orchid}

% new colors
\definecolor{lblue}{RGB}{0, 114, 206}
\definecolor{orange}{RGB}{255, 83, 73}
\definecolor{gray}{RGB}{111, 112, 112}
\definecolor{darkgray}{RGB}{125, 125, 125}

% Macros
\newcommand{\bb}[1]{\textbf{#1}}
\newcommand{\red}[1]{\textbf{\textcolor{red}{#1}}}
\newcommand{\blue}[1]{\textbf{\textcolor{lblue}{#1}}}
\newcommand{\orange}[1]{\textbf{\textcolor{orange}{#1}}}
\newcommand{\gray}[1]{\textcolor{gray}{#1}}
\newcommand{\darkgray}[1]{\textcolor{darkgray}{#1}}
\newcommand{\green}[1]{\textcolor{olive}{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%  Modifying the Theme  %%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamercolor{normal text}{fg=black!70!gray}
\setbeamertemplate{progress bar in head/foot}{}
\setbeamercolor{progress bar}{fg=lblue,bg=lblue}
\setbeamercolor{frametitle}{fg=lblue,bg=lblue!20}
\setbeamercolor{title separator}{fg=lblue,bg=lblue}
% \setbeamercolor{progress bar in head/foot}{fg=lblue,bg=lblue}
\setbeamercolor{progress bar in section page}{fg=lblue,bg=lblue}
\setbeamercolor{block title}{bg=lblue}
% frame breaks
\setbeamertemplate{frametitle continuation}{(\insertcontinuationcount)}

% box
\AtBeginEnvironment{alertenv}{\setbeamercolor{item}{fg=olive}}

%%%% Bullet Points %%%%%
\setbeamertemplate{itemize item}[square]
\setbeamertemplate{itemize subitem}[default]
\setbeamertemplate{itemize subsubitem}[circle]
% \setbeamercolor{local structure}{fg=cyan!50}
\setbeamercolor{itemize item}{fg=cyan!50}
\setbeamercolor{itemize subitem}{fg=cyan!50}
\setbeamercolor{itemize subsubitem}{fg=cyan!50}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%  Sliode Style Setup  %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{xpatch}    % for patching commands

%%%%%%%%% Bullet Points %%%%%%%%%%%%%%%%

% itemize spacing setup
% see https://tex.stackexchange.com/questions/632524/how-to-globally-set-itemize-item-spacing-in-beamer-without-breaking-overlay-spec
% Usage: \setlistsep{10ex}{5ex}{5ex}
\makeatletter
\newlength{\my@beamer@itemsepi}\setlength{\my@beamer@itemsepi}{3ex}
\newlength{\my@beamer@itemsepii}\setlength{\my@beamer@itemsepii}{1.5ex}
\newlength{\my@beamer@itemsepiii}\setlength{\my@beamer@itemsepiii}{1.5ex}
\newcommand{\my@beamer@setsep}{%
\ifnum\@itemdepth=1\relax
     \setlength\itemsep{\my@beamer@itemsepi}% separation for first level
   \else
     \ifnum\@itemdepth=2\relax
       \setlength\itemsep{\my@beamer@itemsepii}% separation for second level
       % \setlength\topsep{\my@beamer@itemsepi}% separation for second level
     \else
       \ifnum\@itemdepth=3\relax
         \setlength\itemsep{\my@beamer@itemsepiii}% separation for third level
         % \setlength\topsep{\my@beamer@itemsepii}% separation for second level
   \fi\fi\fi}
\xpatchcmd{\itemize}
  {\def\makelabel}{\my@beamer@setsep\def\makelabel}{}{}
\xpatchcmd{\beamer@enum@}
  {\def\makelabel}{\my@beamer@setsep\def\makelabel}{}{}
\newcommand\setlistsep[3]{%
    \setlength{\my@beamer@itemsepi}{#1}%
    \setlength{\my@beamer@itemsepii}{#2}%
    \setlength{\my@beamer@itemsepiii}{#3}%
}
\makeatother

% Transparent overlay
\setbeamercovered{still covered={\opaqueness<1->{15}},again covered={\opaqueness<1->{60}}}
\makeatletter
\newcommand*\fix@beamer@close{%
\ifnum\beamer@trivlistdepth>0
    \beamer@closeitem
\fi
}
\newcommand*\fix@beamer@open{%
\ifnum\beamer@trivlistdepth>0
    \gdef\beamer@closeitem{}%
\fi
}
\BeforeBeginEnvironment{itemize}{\fix@beamer@close}
\AfterEndEnvironment{itemize}{\fix@beamer@open}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%  Miscs  %%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{lipsum}

% hyper ref
\RequirePackage{hyperref} 
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=black,      
    urlcolor=black,
    }
\newcommand{\changeurlcolor}[1]{\hypersetup{urlcolor=#1}} 

% Underline
\RequirePackage{ulem}
\newcommand\ulblue{\bgroup\markoverwith
{\textcolor{lblue}{\rule[-0.5ex]{2pt}{0.4pt}}}\ULon}

% tikz
\RequirePackage{tikz}
\RequirePackage{standalone}

% table
\RequirePackage{wrapfig}

% frame
\RequirePackage{mdframed}

% Hide parts
\RequirePackage{comment}
\excludecomment{hide}   % \being{hide} ... \end{hide} will not be printed

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%  Math  %%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% Basic Packages %%%%
\mathtoolsset{showonlyrefs=true}    % show equation number only if it is referenced
\RequirePackage{amsthm} 
\RequirePackage{bm}   % optional


% Macros
\newcommand{\E}{\mathbb{E}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\oo}{\mathcal{O}}
\newcommand{\U}{\mathcal{U}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\prob}{\mathbb{P}}
\newcommand{\argmin}{\mathop{\rm arg~min}\limits}
\newcommand{\argmax}{\mathop{\rm arg~max}\limits}

%% Project-specific macro
\newcommand{\pih}{\overline{\pi}}

% theorem macro
\newtheorem{algorithm}[theorem]{Algorithm}
\newtheorem{axiom}[theorem]{Axiom}
\newtheorem{case}[theorem]{Case}
\newtheorem{claim}{Claim}
\newtheorem{conclusion}[theorem]{Conclusion}
\newtheorem{condition}[theorem]{Condition}
\newtheorem*{cL}{Condition L}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{criterion}[theorem]{Criterion}
\newtheorem{exercise}[theorem]{Exercise}
\newtheorem{proposition}{Proposition}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{summary}[theorem]{Summary}
\newtheorem{prediction}{Prediction}

